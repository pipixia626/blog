# IO

## 操作系统与设备的I/O

操作系统通过设备驱动程序访问IO设备
1. 轮询方式
    主动在各种设备中轮询检查状态，有数据就IO
2. 中断方式
    设备有数据的时候，发出中断，由CPU决定要不要响应中断，然后中断，去处理设备的IO。CPU不用经常轮询设备状态。被动接收中断就行
3. DMA直接存储器访问
    如果1个字节的数据中断一次，传1KB的数据得中断1024次，太浪费CPU时间，于是有了DMA方式，CPU只需要把开头和结束的地址告诉DMA，中间由DMA完成数据IO。CPU从字节干预解放到数据块的干预。
4. 通道控制方式
    DMA方式只能控制一个设备的一块数据，多块数据还是要CPU干预多次。于是有了通道来控制IO，它比DMA更强大，能控制多块数据，多个设备的IO，更加解放了CPU参与IO过程。
## 操作系统与用户进程间的IO
设备来的数据存放道内核cache中，需要用户线程去内核cache中取数据，复制到自己进程的cache中

5种IO

### 阻塞
用户线程调用某些系统函数去内核取数据，直到数据到达内核cache前，线程处于阻塞状态，一直等待数据到达
### 非阻塞
用户线程去取数据，不管内核cache有没有数据都直接返回，可能拿到数据，也可能拿不到，不会使线程进入阻塞态。
### I/O多路复用
多路就是一个线程管理多路IO，线程还是被阻塞调用，其中一路或几路IO有数据了就返回。需要线程遍历全部IO，判断是哪个IO有数据。
### 信号驱动IO
给一个IO注册一个信号和信号触发的回调函数，一旦信号被触发，回调函数里读取数据。
例如给 socket 注册一个“可读”的信号，当数据来了，可读的时候，信号被触发，执行回调函数从内核cache复制数据到用户空间。

### 异步IO
异步IO中，操作系统完成了数据从内核到用户空间的拷贝后，以信号的方式通知用户线程可以下一步操作。省去了用户线程阻塞下来拷贝数据的过程。